---
layout: post
title: Coupling and Cohesion and the Death of Test-Driven
disqus_short_name: optimizedprogrammer
disqus_url: http://optimizedprogrammer.com/blog/coupling-and-cohesion-and-the-death-of-test-driven
guid: http://optimizedprogrammer.com:80/blog/coupling-and-cohesion-and-the-death-of-test-driven
---

<p>It was over a year ago that <a href="http://david.heinemeierhansson.com/" target="_blank">David Heinemeier Hansson</a> made the assertion that “<a href="http://david.heinemeierhansson.com/2014/tdd-is-dead-long-live-testing.html" target="_blank">TDD is dead.</a>”</p> <p>testDrivenDevelopment.Living.ShouldBeFalse();</p> <p><a href="http://optimizedprogrammer.com/Media/OptimizedProgrammer/Windows-Live-Writer/Coupling-and-Cohesion_87EA/Death_2.jpg"><img title="Death" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="Death" src="http://optimizedprogrammer.com/Media/OptimizedProgrammer/Windows-Live-Writer/Coupling-and-Cohesion_87EA/Death_thumb.jpg" width="218" height="231"></a></p> <p>This resulted in many reactions, including those of Martin Fowler and Kent Beck and led to a series of video discussions involving these three thoughtful influencers.&nbsp; I didn’t watch these videos at the time, but came across them recently and was riveted to the conversation.&nbsp; DHH has such a candid way about him.&nbsp; He has clearly thought through his positions and doesn’t let widely accepted dogma get in the way of expressing his opinion.&nbsp; It is remarkable and admirable.</p> <p>After DHH wrote the above assertion into a test, these three giants of software development engaged in a conversation that was the implementation, the class under test, to see if the test would pass.</p> <p>The interaction between Kent Beck and DHH was priceless.&nbsp; Fowler mostly observed and moderated and added some well-timed insight occasionally.&nbsp; If you haven’t already watched these, you absolutely must.&nbsp; If you did watch a year ago, you must watch again.</p> <p>At 21:20 of <a href="https://www.youtube.com/watch?v=JoTB2mcjU7w" target="_blank">this video</a> (below), Kent Beck started (along a line that would lead to) talking about coupling and cohesion.</p> <p><iframe height="315" src="https://www.youtube.com/embed/JoTB2mcjU7w?start=1280" frameborder="0" width="560" allowfullscreen></iframe></p> <p>As Beck started down a path of saying that high cohesion leads to loose coupling, DHH challenged the notion.&nbsp; This, I think gets to the core of his initial thesis in asserting that TDD is dead.&nbsp; He was really talking about how TDD is a practice with a lot of virtue, especially around the idea of confidence and rapid feedback, and it has a potential to reveal insight into the domain and to help flesh out the design, but not without cost.&nbsp; He goes further to argue that dogmatic TDD with rigid adherence to ideas about the performance of the tests can be, and often is, counterproductive.&nbsp; That coupling and cohesion can be changed with partial autonomy and that the relationship between high cohesion and loose coupling can be adversarial makes sense to me.&nbsp; I’ve experienced that as well.</p> <p>Coupling and cohesion have a relationship, but they are, to a degree, two independent attributes of the source code for whatever unit is of concern (this could be at the level of a method, a class, a library, a process, a microservice, a bounded context, or an entire system).&nbsp; <a href="http://enterprisecraftsmanship.com/about/" target="_blank">Vladimir Khorikov</a> has <a href="http://enterprisecraftsmanship.com/2015/09/02/cohesion-coupling-difference/" target="_blank">a really nice post describing the results of different relative levels of cohesion and coupling</a>.&nbsp; In it he outlines and shows graphically what happens when cohesion is high and coupling low, coupling high and cohesion low, and all 2<sup>2</sup> permutations of this Cartesian Product.&nbsp; Looking at Vladimir’s illustrations and descriptions, we can all easily recall code we’ve encountered falling into each of these categories.</p> <p>When DHH is talking about <a href="http://david.heinemeierhansson.com/2014/test-induced-design-damage.html" target="_blank">Test-induced design damage</a> and Vladimir about “destructive decoupling,” I hear the same thing.&nbsp; In fact, as DHH points out, much of the decoupling done in many codebases is done in the name of testability.&nbsp; Kent Beck is fond of talking about choosing your tradeoffs and rightly so – this is ultimately the core responsibility of software construction.&nbsp; I recall questioning in the days when I was learning about not only TDD, but unit testing itself, whether things I was doing had reason beyond testability or if I was just doing things for the sake of the tests and changing the structure of my code just to make it testable.&nbsp; It felt wrong, but I dismissed the misgivings with a wave of a hand and a trust that this was making things better.</p> <p>So many times I’ve taken on faith that something is making things better just because it’s supposed to make things better.&nbsp; Those uneasy feelings often arise for a reason.&nbsp; When I had to make changes because of new requirements or rethinking of domains and found myself going through multiple layers of what was being returned by mocks before I could every get close to dealing with the actual testing of what I wanted to change, I felt pain.&nbsp; Pain is where we finally start to see how things are not as clear as the religion would lead us to believe.</p> <p>The discussion in the entire series regarding testing the death of TDD ultimately comes down to just this – there are costs associated with every approach we take.&nbsp; Test-Driven Development has undeniable benefits.&nbsp; DHH did us a favor to stem the fervor, though, of considering it to be a <a href="https://en.wikipedia.org/wiki/No_Silver_Bullet" target="_blank">silver bullet</a> in our proverbial chamber.</p> <p>If saying that TDD is dead means that using TDD as a club to beat into submission anyone who isn’t willing to close their eyes and follow leaders into a path of using test coverage as a goal or decoupling everything because of testability, then yes, it’s ok to pronounce death (could it be dead to a degree - maybe it’s only “<a href="https://www.youtube.com/watch?v=xbE8E1ez97M" target="_blank">mostly dead</a>”?)&nbsp; Suspending your skeptical nature and following the one true way is almost always a recipe for failure.&nbsp; Taking what you can from TDD is a good approach.&nbsp; Mocking some dependencies in places where it makes sense and you need to have confidence something works to be able to make changes and using real databases, etc. would make the tests slow is often good advice.&nbsp; Mocking every dependency often costs too much to be a good idea.</p> <p>Every decision you make in your design and implementation has benefits and it has problems.&nbsp; Every user of The Force has the capacity to turn to the Dark Side.&nbsp; The best thing we can do is to be aware of the choices we have to make, the consequences of the options, and choose consciously.</p>
